# 🚀 교차 김프 아비트라지 거래 로직 설계 (최종 정리본)

## ✅ 전략 개요

국내와 해외 거래소 간 암호화폐 가격차(김치 프리미엄)를 이용하여 무위험 수익을 얻는 전략입니다. 다음 두 개의 독립된 흐름을 동시에 실행해 가격 변동 위험을 헤지합니다.

* **전송코인**: 국내 → 해외로 전송하여 **USDT 확보**
* **수익코인**: 해외 → 국내로 전송하여 **KRW 확보**

모든 계산은 **실시간 USDT/KRW 환율**을 기준으로 통일하여 비교하며, 환전 과정 없이 양쪽 거래소에서 KRW와 USDT가 항상 충분히 확보되어 있습니다.

---

## 📌 핵심 거래 절차 (필수 동시 진행 단계)

김치 프리미엄으로 인한 수익 기회가 감지되는 순간, 다음 **4가지 주문을 동시에** 실행합니다.

| **동시 실행 거래** | **거래소** | **주문 유형** | **목적** |
|:----------------------|:---------------|:------------------|:----------------------|
| ① 전송코인 국내 매수      | 업비트 or 빗썸    | 시장가 매수          | 국내 코인 확보 및 해외 전송 |
| ② 전송코인 해외 마진 숏    | 바이낸스 or 바이빗 | 마진 대출 숏        | 전송 중 코인 가격 변동 헤지 |
| ③ 수익코인 해외 매수      | 바이낸스 or 바이빗 | 시장가 매수          | 해외 코인 확보 및 국내 전송 |
| ④ 수익코인 해외 선물 숏    | 바이낸스 or 바이빗 | 선물 숏 포지션 오픈   | 전송 중 글로벌 가격 변동 헤지 |

**이 4가지 주문은 한 순간(수 초 이내)에 동시 실행되어야 합니다.**


예시(거래소 예시) 
전송코인 // 수익코인
업비트 A > 바이빗 A // 업비트 A < 바이낸스 A
업비트  A > 바이빗 A // 업비트 B < 바이빗 B
업비트 A > 바이빗 A // 빗썸 B < 바이낸스 B
업비트 A > 바이낸스 A // 빗썸 B < 바이빗 B


---

## 🔍 전송코인 (국내→해외) 상세 로직

### ① 국내 시장가 매수
* 목표 주문 금액 (예: 1,000만원)으로 전송코인을 시장가 매수
* 출금 수수료(코인 단위)만큼 추가 매수
* 국내 거래 수수료(0.05~0.1%) 반영

### ② 해외 마진 대출 숏
* 국내에서 매수한 동일 수량만큼 해외 거래소에서 마진 대출하여 즉시 시장가 매도
* 이 단계로 전송 중 가격 변동 완벽 헤지
* 해외 거래 수수료(약 0.1%) 반영, 마진 이자는 무시 가능

### ③ 전송 및 상환
* 국내 매수한 전송코인을 해외 거래소로 송금 (약 10~20분 소요)
* 도착 즉시 마진 대출 상환 (추가 비용 없음)

### 🔖 전송코인 수익 계산식
R_T = \frac{\text{해외에서 확보한 USDT}}{\text{국내에서 사용한 KRW}}

---

## 🔍 수익코인 (해외→국내) 상세 로직

### ① 해외 시장가 매수
* 전송코인 단계에서 확보된 USDT로 수익코인을 시장가 매수
* 출금 수수료(코인 단위) 추가 매수
* 해외 거래 수수료(약 0.1%) 반영

### ② 해외 선물 숏 오픈 (헤지)
* 수익코인 매수 직후 동일 수량만큼 해외 선물 시장에서 즉시 숏 포지션 진입
* 글로벌 가격 변동 완벽 헤지 (김프 변동 제외)
* 선물 거래 수수료(왕복 약 0.04~0.1%) 반영

### ③ 수익코인 국내 전송 및 매도
* 해외에서 국내 거래소로 수익코인을 전송 (약 10~20분 소요)
* 국내 도착 즉시 시장가 매도 (매도 수수료 약 0.05~0.1%)
* 동시에 해외 선물 숏 포지션 즉시 청산

### 🔖 수익코인 수익 계산식
R_P = \frac{\text{국내에서 회수한 KRW}}{\text{해외에서 사용한 USDT}}

---

## 💡 통합 수익률 계산 (최종 수익성 평가)

두 흐름을 결합하면 KRW→USDT→KRW 순환 구조로, 최종적인 차익은 아래와 같습니다.

* **통합 수익률 (배수)** = R_T \times R_P
* **통합 이익률 (%)** = (R_T \times R_P - 1) \times 100\%

예:
* 전송코인 환율효율 R_T = 0.00077\;USDT/KRW
* 수익코인 프리미엄효율 R_P = 1305.19\;KRW/USDT
* → 통합 배수 = 0.00077 \times 1305.19 = 1.0050 (수익률 약 0.50%)

---

## 🚩 리스크 관리 및 헷지 방법

| **구분** | **리스크 유형** | **헷지 방법** |
|:---------|:----------------|:-------------|
| 전송코인 | 가격 변동 위험 | 해외 마진 숏(즉시 헷지) |
| 수익코인 | 글로벌 가격 변동 위험 | 해외 선물 숏(즉시 헷지) |
| 수익코인 | 김치 프리미엄 변동 위험 | 거래 직전 국내 오더북을 분석하여 위험 발견 시 거래 금액 즉각 축소 또는 거래 중지 |

* 김프 급락 위험은 **실시간 국내 오더북 분석(매수 호가 물량 급감 등)**으로 사전 탐지하여 거래 규모를 축소 조정함으로써 효과적으로 방어합니다.

---

## 🚀 실시간 오더북 데이터 및 자동 트리거 구조 (정리)

* 초당 1000~3000건의 국내외 오더북 데이터 수집
* 국내외 오더북을 실시간으로 비교, 수익성 스코어링 (매 순간 갱신)
* 예상 수익률 R_T \times R_P - 1 \ge 0.1\% 초과 시 자동 거래 트리거 발생
* 자금 회전은 1분 단위로 실행 (최대 동시 진행 가능 거래 수: 80건 (8억 버퍼 기준))

---

## 📌 최종 거래 동시 실행 흐름 (정리)

| **단계** | **액션** | **상세 내용** |
|:---------|:---------|:-------------|
| 1 | 거래기회 탐지 | 실시간 데이터 분석으로 수익률 0.1% 이상 기회 발견 |
| 2 | 동시 4건 실행 | ①전송 국내 매수, ②전송 해외 마진 숏, ③수익 해외 매수, ④수익 해외 선물 숏 |
| 3 | 전송 진행 | 각각 해외↔국내 송금 (10~20분 소요) |
| 4 | 완료 처리 | 해외 마진 상환, 국내 현물 매도, 해외 선물 청산 |
| 5 | 자금 회수 및 재사용 | 완료된 자금은 즉시 재투입 가능 상태로 회수 |

---

## ✅ 정리 및 구현 시 고려사항

* 실시간성을 높이고 거래소 API 안정성 고려
* 호가 스프레드와 슬리피지 정확히 계산 반영
* 실시간 오더북을 통한 김프 급락 위험 예측 필수
* 멀티스레딩 및 병렬 처리로 동시 거래 정확도 높이기
* 충분한 자금 버퍼로 다수 거래 동시 진행 가능하게 설계

이 최종 정리본은 **모든 핵심 요구 사항을 충실히 반영하였으며**, 실제 개발과 구현 시 직관적이고 명확한 구조로 바로 활용 가능합니다.